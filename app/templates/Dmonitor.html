{% extends 'baseDashboard.html' %}
{% block content %}
    <div id="form-wrapper"></div>
{% endblock %}
{% block scripts %}
<script>

  document.addEventListener("DOMContentLoaded", function () {  
        const data = JSON.parse('{{ data|escapejs }}');
        createTabelForm(
            'form-wrapper',
            'search-table',
            'Data Pengusaha Berdenda',
            'Informasi Jumlah Transaksi Berdenda',
            'dendaPengusaha.xlsx',
            'dendaPengusaha.pdf'
        );
        _tabel(data);
  }); 
 

  function _tabel(dt) {
    console.log(dt);
    
    const total = dt.reduce((sum, v) => sum + v.transaksi_jmlhbayardenda, 0);
    console.log(total);
    
    const tableHTML = `
        <thead class="bg-indigo-600 text-white">
        <tr>
            <th class="px-4 py-2">No</th>
            <th class="px-4 py-2">Jenis</th>
            <th class="px-4 py-2">Target</th>
            <th class="px-4 py-2">Realisasi</th>
            <th class="px-4 py-2">gap</th>
            <th class="px-4 py-2">Persentase</th>
        </tr>
        </thead>
        <tbody class="bg-white divide-y divide-gray-200">
        ${dt.map((v, i) => `
            <tr>
            <td class="px-4 py-2">${i + 1}</td>
            <td class="px-4 py-2">${v.jenis|| '-'}</td>
            <td class="px-4 py-2">${v.target_nominal?.toLocaleString()|| '-'}</td>
            <td class="px-4 py-2">${v.pajak?.toLocaleString()|| '-'}</td>
            <td class="px-4 py-2">${v.gap?.toLocaleString()|| '-'}</td>
            <td class="px-4 py-2">${v.persentase.toFixed(2)} %</td>
            </tr>
        `).join("")}
        </tbody>
    `;

    setTimeout(() => {
        const table = document.getElementById("search-table");
        table.innerHTML = tableHTML;

        setTimeout(() => {
            new simpleDatatables.DataTable("#search-table", {
            searchable: true,
            fixedHeight: true,
            perPage: 10,
            });
        }, 100); 
    }, 100);

    
    
  }

</script>
{% endblock %} 